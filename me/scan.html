<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>扫描二维码</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<link rel="stylesheet" href="css/mui.min.css">
		
		<style>
			#bcid {
				background: white;
				height:480px;
				width: 360px;
				
			}
			.fbt {
			width: 50%;
			height: 100%;
			float: left;
			border:1px solid #fff;
		}
		.mui-bar-footer {
			width: 100%;
			height: 44px;
			position: absolute;
			bottom: 0px;
			line-height: 44px;
			text-align: center;
			color: #fff;
		}
		</style>
	</head>
	<body>
		<header class="mui-bar mui-bar-nav" style="background: dodgerblue">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="color:#000"></a>
			<h1 class="mui-title">扫描二维码/条码</h1>
		</header>
		<div class="mui-content">
			<div id="bcid"></div>
		</div>
			

		<div class="mui-bar-footer">
			<button type="button" class=" fbt mui-btn mui-btn-primary mui-action-back" >取消</button>
			<button type="button" class=" fbt mui-btn mui-btn-primary" onclick="scanPicture()">扫描本地图片</button>
		</div>
		<script src="js/mui.min.js"></script>
		<script>
			mui.init({
				swipeBack:true //启用右滑关闭功能
			});
			// 扩展API加载完毕后调用onPlusReady回调函数 
			document.addEventListener( "plusready", onPlusReady, false );
			// 扩展API加载完毕，现在可以正常调用扩展API 
			function onPlusReady() {
				startRecognize();
				startScan();
			}

			
			
			
			var scan = null;
			function onmarked( type, result) {
				var text = '未知: ';
				switch(type){
					case plus.barcode.QR:
					text = 'QR: ';
					break;
					case plus.barcode.EAN13:
					text = 'EAN13: ';
					break;
					case plus.barcode.EAN8:
					text = 'EAN8: ';
					break;
				}
				alert( text+result );
				startRecognize();
			}
			function scanPicture(){
			    plus.gallery.pick(function(path){
				    plus.barcode.scan(path,onmarked,function(error){
						plus.nativeUI.alert('无法识别此图片');
					});
			    }, function(err){
			        plus.nativeUI.alert('Failed: '+err.message);
			    });
			}
			function startRecognize() {
				var filters = [plus.barcode.QR,plus.barcode.AZTEC,plus.barcode.EAN13,plus.barcode.EAN8,plus.barcode.DATAMATRIX,plus.barcode.UPCA,plus.barcode.UPCE,plus.barcode.CODABAR,plus.barcode.CODE39,plus.barcode.CODE93,plus.barcode.CODE128,plus.barcode.ITF,plus.barcode.MAXICODE,plus.barcode.PDF417];
				var styles = {frameColor:"#0d0",scanbarColor:"#0d0",background:"#eee"};
				scan = new plus.barcode.Barcode('bcid',filters,styles);
				scan.onmarked = onmarked; 
				startScan();
			}
			function startScan() {
				scan.start({vibrate:true,sound:"default"});
			}
			function cancelScan() {
				scan.cancel();
			}
			function setFlash() {
				scan.setFlash();
			}
		</script>
	</body>
</html>
